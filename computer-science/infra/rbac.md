# RBAC 也非常简单

<!--
ID: 02815266-96e1-46f4-876a-77b2d2d78531
Status: draft
Date: 2020-05-28T14:09:32
Modified: 2020-05-28T14:09:32
wp_id: 947
-->

周末研究了下 RBAC，发现其实挺简单的，要实现一下更是非常简单。django 的用户权限系统相对来说就有点过于简单了，而且二次开发也非常不方便。

RBAC 中的对象主要分为以下几个：

- User，用户
- Group，分组
- Role，角色
- Permission，权限
- Resource，资源
- Operation, 对资源的某种操作

资源的分类有多种方式，比如按照数据库中表来分类，或者按照页面来分类。

将资源构成一些列的小权限，然后在将小权限合成大权限，形成一个权限树结果，然后，不同角色从树上找适合自己的权限。

平台中，把角色分为组织机构类型、岗位类型、和其他类型，比较符合具体业务，分类较为完整。
系统中应该内置几种常见角色，方便用户使用

系统分为三种用户：

- 超级管理员，也就是 root 账号，拥有所有权限，无法删除。
- 管理员，凡是没有禁止的都可以访问，可以添加反向权限
- 普通用户，凡是没有开放的都不可以访问，正向权限

传统的 RBAC 中只有正权限，这样显然是不够方便的，尤其对管理员来说。这个可以通过内置管理员角色来实现

# 权限继承

在上面的讨论中，我们都没有考虑继承关系。然而在现实世界中，继承关系是普遍存在的。比如说：“CTO -> Tech Lead -> 程序员” 之间的上下级关系。然而对于权限来说，显然是要反过来的，也就是程序员有的权限 CTO 肯定有，而 CTO 有的权限，程序员不一定有。或者说：CTO "is-a" 程序员。也就是说，权限的继承关系是：“程序员 -> Tech Lead -> CTO”。

RBAC 中还有一些更高级的概念，比如说角色的互斥：例如在大多数公司中会计和出纳不能是同一个人。这部分我们就不展开了。

# 权限粒度

RBAC 中一个比较重要的问题是粒度。通过对 Resource 的粒度的控制，可以做到达到整个系统，小到数据库的某个字段的控制，或者细化大数据库的某条记录。抽象出来无非以下几点：

- 某个资源的不同操作的权限，比如增删改查搜索等分别是不同的；
- 某个资源的某个元素的权限，比如说在一个博客系统的文章表中，用户只能操作自己的文章；
- 某个资源的某个属性的权限，比如说用户只能修改自己的姓名，而不能修改自己的 VIP 状态，是否是 VIP 只能由系统修改。实际上这可以通过把资源粒度切得更细实现；
- 其他复杂的复合权限，比如说是否可以评论某篇文章。

# 参考

1. https://files-cdn.cnblogs.com/files/Wenzy/an_introduction_to_rbac.pdf
2. http://www.woshipm.com/pd/960810.html
3. 