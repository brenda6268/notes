# 智能家居折腾记（1）—— 路由器

<!--
ID: d407c2ce-0e21-4595-ab7c-9bf70f907ce8
Status: draft
Date: 2018-04-29T05:15:00
Modified: 2020-05-16T11:37:02
wp_id: 441
-->

"智能"的本质是傻瓜和可编程性。对普通用户傻瓜，点开即用；对高级用户具有可编程性，从而让高级用户开发更多的傻瓜功能给普通用户。

# 路由器的应用

* 无缝翻墙
* 离线下载
* Time Capsule/Airport
* NAS
* 无线打印机
* 智能音箱
* CDN
* OpenMV

## 驳一些反对意见

1. 智能路由器的功能完全可以在PC中设置

    普通家庭以后根本不会有 PC，而且就现在而言，打开率已经很低了。

2. 远程下载？你很有空在工作期间控制自己的路由器？

    有的

   网速越来越快，哪儿还需要离线下载啊？

    总有资源比较冷门，即使有光纤，要长时间挂机。

3. 再智能，你还得让用户设置、找回密码不是？

    可以不用的，以后路由器的发展方向应该是利用手机卡，而不是利用宽带的账号密码，所以根本不需要任何设置的

4. 长期稳定运行、信号覆盖广强度好、高性能，这些才是无线路由器的核心而且首要的刚性需求

    手机的第一要务不是能打电话，而是能稳定使用。路由器为啥智能一些？计算机的本职工作就是对输入的数据加工处理。手机的主要功能就是打电话

## 可以改进的地方

路由器只有一个网络，进行设置的时候不光需要连接特定的网络，还需要输入 `192.168.1.1` 这种对于普通用户来说完全是乱码的东西，应该使用蓝牙连接设置。

智能路由器现在面对的最大的竞争对手就是智能音箱了，其次是电视盒子。智能音箱胜在了友好的人机界面，直接通过自然的语音控制，而如上文所述，路由器的链接配置根本不是普通用户可以驾驭的。现在的智能路由器们感觉像是 Windows Mobile 时代的智能手机一样。

路由器至少应该带一个高清的触摸屏来直接控制。

在 IPv4 的情况下，路由器很有可能没法获得公网 IP，也就是无法通过外网直接访问，即使是获得了公网 IP，记忆一串数字也是很难的，因此需要一个内网映射系统，比传统的 DDNS 更强大，更傻瓜。

## 一些花里胡哨的东西

* [Almond Plus](https://www.securifi.com/rg/almondplus)，这个产品有点丑，不过该有的功能都有了，而且是在13年，真是超前啊。
    ![](https://d1ps2o5uupey1c.cloudfront.net/wp-content/themes/eusense/images/almond+.png)

    相关评测也不少：
    1. http://www.dgtle.com/thread-144776-1-1.html
    2. https://www.tomsguide.com/us/securifi-almond-router,review-2823.html
    3. 视频：https://3g.163.com/v/video/VCR1A1F1R.html

    总体来说思路非常正确，但是缺点也很明确：
    1. 触屏太小，操作也很复杂
    2. 作为 WiFi 路由器性能不够好，这是致命的，最基本的功能要保证
    3. 依然停留在使用有线上网的思路，这也是配置繁琐的原因

    总体感觉很像 iPhone 来临之前的 Windows Mobile。

# 路由器性能指标

主要从硬件方面来考虑

## 802.11 系列协议

150/300/450 Mbps 分别指的是路由器的最大带宽

802.11b/g/n/ac 分别对应的是 IEEE 定义的无线通讯协议族，其中 11g 传输速率为 54Mbps，11n 可以达到 300Mbps，通过MIMO、OFDM 技术，甚至可以达到 600Mbps。11ac支持双频段，即2.4GHz和5GHz的混合，其传输速率可以1000Mbps，上网更加畅快。

2.4G 和 5G 指的是不同频段。我们现在用的路由器多数是2.4GHz，这个频段技术成熟，具有信号穿透力好的特点，但是呢大家你也用我也用，造成信道拥堵。5GHz则正好相反，传输率高（网速快！），但是穿透性不佳。不过5GHz不是多么新鲜的技能，802.11n可以同时兼容2.4GHz和5GHz

## 天线增益

现在普遍的路由器天线增益有2dbi/3dbi/5dbi，一般做到2和3的都不会写，只有做到5的才会得瑟一下，让你看到

## CPU/RAM/Flash

QoS 一般很消耗 CPU 资源。

QoS 指的是分组控制流量，保证服务质量。


# OpenWrt

## 设备选购

### 成品路由

OpenWrt 是一个基于 Linux 的开源路由器固件，市面上不少路由器都支持，不过大部分路由器的内存大都在 64M 以下，都小的可怜。从 [Openwrt 官方支持的设备列表](https://openwrt.org/toh/views/toh_available_864)可以看到 小米路由器 3G 还算不错了，提供了 256M 的内存。而其他一些配置相当的都很难买到全新的，只能在淘宝上买些洋垃圾，比如 netgear 4300。。

![](https://ws3.sinaimg.cn/large/006tNc79ly1fqtgi6h7bnj31e80cu76r.jpg)

### 开发板

除了购买消费级的路由器然后刷机之外，另一个选择是直接购买 Wifi 开发板，经过一番考察，MTK 出品的 MT7688/7628 应该是不错的选择。淘宝上有不少第三方出品的开发吧，包括 MTK 自己出品的 LinkIt，都是基于 OpenWrt 的。

参考：

1. https://www.zhihu.com/question/19958940
2. [提升路由器速度的优化方法](http://www.cnblogs.com/kaiye/p/5802065.html)